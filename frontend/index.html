<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllerCare | Intelligent Allergy Care</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Auth specific styling to handle the login/reg transition */
        #auth-section {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            /* Using a high-quality background for the login screen */
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), 
                        url('https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?auto=format&fit=crop&q=80&w=1920');
            background-size: cover;
            background-position: center;
        }
        .auth-card { width: 100%; max-width: 400px; display: none; }
        .auth-card.active { display: block; }
        .auth-toggle {
            text-align: center;
            margin-top: 20px;
            cursor: pointer;
            color: var(--color-primary);
            font-weight: 600;
            text-decoration: underline;
        }
        /* Hide dashboard and modules initially until login check */
        #dashboard, .module, header, .top-nav-user { display: none; }
    </style>
</head>
<body>

    <div id="userWelcome" class="top-nav-user"></div>

    <div id="auth-section">
        <div id="login-card" class="glass-container auth-card active">
            <h2 style="text-align:center;"><i class="fas fa-lock"></i> Welcome Back</h2>
            <p style="text-align:center; color: var(--color-light-text);">Login to your account</p>
            <div class="input-group">
                <label>Email Address</label>
                <input type="email" id="email" placeholder="Enter your email">
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="password" placeholder="••••••••">
            </div>
            <button onclick="login()" class="main-btn">Login to AllerCare</button>
            <p class="auth-toggle" onclick="toggleAuth('register-card')">New here? Create an account</p>
        </div>

        <div id="register-card" class="glass-container auth-card">
            <h2 style="text-align:center;"><i class="fas fa-user-plus"></i> Join AllerCare</h2>
            <p style="text-align:center; color: var(--color-light-text);">Start your allergy-safe journey</p>
            <div class="input-group">
                <label>Full Name</label>
                <input type="text" id="regName" placeholder="John Doe">
            </div>
            <div class="input-group">
                <label>Email Address</label>
                <input type="email" id="regEmail" placeholder="email@example.com">
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="regPassword" placeholder="••••••••">
            </div>
            <button onclick="register(event)" class="main-btn">Create Account</button>
            <p class="auth-toggle" onclick="toggleAuth('login-card')">Already have an account? Login</p>
        </div>
    </div>

    <header id="main-header">
        <h1>AllerCare</h1>
        <p>Your Intelligent Allergy Detection & Care Platform</p>
    </header>

    <div class="container" id="dashboard">
        <div class="card" onclick="showModule('food-module')">
            <i class="fas fa-utensils"></i>
            <h3>Food Allergy</h3>
            <p>Check food products for potential allergens.</p>
        </div>
        <div class="card" onclick="showModule('skincare-module')">
            <i class="fas fa-pump-medical"></i>
            <h3>Skincare Product</h3>
            <p>Analyze skincare ingredients for risks.</p>
        </div>
        <div class="card" onclick="showModule('chat-module')">
            <i class="fas fa-robot"></i>
            <h3>Assistant</h3>
            <p>AI-powered assistant for allergy queries.</p>
        </div>
        <div class="card" onclick="showModule('medicine-module')">
            <i class="fas fa-pills"></i>
            <h3>Medicine Allergy</h3>
            <p>Check medicines for reactions.</p>
        </div>
        <div class="card" onclick="showModule('image-module')">
            <i class="fas fa-camera"></i>
            <h3>Upload Image</h3>
            <p>Analyze symptoms via photos.</p>
        </div>
    </div>

    <div id="food-module" class="module">
        <div class="glass-container">
            <button class="back-btn" onclick="showModule('dashboard')"><i class="fas fa-arrow-left"></i> Back</button>
            <h3><i class="fas fa-utensils"></i> Food Product Check</h3>
            <div class="input-group">
                <label>Search Product Name</label>
                <input type="text" id="foodIngredients" list="productSuggestions" placeholder="e.g., Nutella...">
                <datalist id="productSuggestions"></datalist>
            </div>
            <button onclick="analyzeFood()" class="main-btn">Analyze Food</button>
            <div id="foodResult" class="result-box"></div>
        </div>
    </div>

    <div id="skincare-module" class="module">
        <div class="glass-container">
            <button class="back-btn" onclick="showModule('dashboard')"><i class="fas fa-arrow-left"></i> Back</button>
            <h3><i class="fas fa-pump-medical"></i> Skincare Analysis</h3>
            <div class="input-group">
                <label>Category</label>
                <input type="text" id="skinLabel" list="labelSuggestions" placeholder="Category (e.g. Moisturizer)">
                <datalist id="labelSuggestions"></datalist>
            </div>
            <div class="input-group">
                <label>Brand</label>
                <input type="text" id="skinBrand" list="brandSuggestions" placeholder="Brand Name">
                <datalist id="brandSuggestions"></datalist>
            </div>
            <button onclick="analyzeSkincareV2()" class="main-btn">Analyze Ingredients</button>
            <div id="skincareResult" class="result-box"></div>
        </div>
    </div>

    <div id="medicine-module" class="module">
        <div class="glass-container">
            <button class="back-btn" onclick="showModule('dashboard')"><i class="fas fa-arrow-left"></i> Back</button>
            <h3><i class="fas fa-pills"></i> Medicine Safety</h3>
            <div class="input-group">
                <label>Medicine Name</label>
                <input type="text" id="medicineInput" placeholder="Enter Medicine Name...">
            </div>
            <button onclick="analyzeMedicineV2()" class="main-btn">Check Safety</button>
            <div id="medicineResult" class="result-box"></div>
        </div>
    </div>

    <div id="chat-module" class="module">
        <div class="glass-container">
            <button class="back-btn" onclick="showModule('dashboard')"><i class="fas fa-arrow-left"></i> Back</button>
            <h3><i class="fas fa-robot"></i> AI Assistant</h3>
            <div id="chatBox" style="background: rgba(255,255,255,0.4); border-radius: 12px; height: 300px; overflow-y: auto; padding: 20px; margin-bottom: 15px; border: 1px solid rgba(0,0,0,0.05);">
                <p><strong>Assistant:</strong> Hello! How can I help you today regarding allergies?</p>
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="chatInput" placeholder="Ask a question..." style="margin: 0;">
                <button onclick="alert('Connecting to AI...')" class="main-btn" style="width: auto; padding: 0 20px;">Send</button>
            </div>
        </div>
    </div>

    <div id="image-module" class="module">
        <div class="glass-container">
            <button class="back-btn" onclick="showModule('dashboard')"><i class="fas fa-arrow-left"></i> Back</button>
            <h3><i class="fas fa-camera"></i> Image Symptom Analysis</h3>
            <p class="note" style="margin-bottom: 15px;">Upload a photo of a rash, product label, or symptom for AI analysis.</p>
            <div class="input-group">
                <input type="file" id="allergyImage" accept="image/*" style="padding: 20px; border: 2px dashed #ddd; background: #fff;">
            </div>
            <button onclick="alert('Image processing model is loading...')" class="main-btn">Analyze Photo</button>
            <div id="imageResult" class="result-box"></div>
        </div>
    </div>

    <script src="script.js"></script>
<script>
    // 1. Toggle between Login and Register cards
    function toggleAuth(cardId) {
        document.querySelectorAll('.auth-card').forEach(card => card.classList.remove('active'));
        const target = document.getElementById(cardId);
        if (target) target.classList.add('active');
    }

    // 2. The Master Navigation Controller
    function renderAppView() {
        const userId = localStorage.getItem('userId');
        
        // Grab all main UI containers
        const authSection = document.getElementById('auth-section');
        const dashboard = document.getElementById('dashboard');
        const header = document.getElementById('main-header');
        const nav = document.getElementById('userWelcome');

        if (userId && userId !== "undefined" && userId !== "null") {
            // USER LOGGED IN: Show Dashboard
            authSection.style.setProperty('display', 'none', 'important');
            dashboard.style.display = 'flex';
            header.style.display = 'block';
            nav.style.display = 'flex';
            
            // Call displayUser from script.js to show the name
            if (typeof displayUser === 'function') {
                displayUser();
            }
        } else {
            // USER NOT LOGGED IN: Show Login
            authSection.style.display = 'flex';
            dashboard.style.display = 'none';
            header.style.display = 'none';
            nav.style.display = 'none';
        }
    }

    // Run on page load
    window.addEventListener('DOMContentLoaded', renderAppView);
    
    // Safety check: if for some reason the page loads but data isn't ready
    window.addEventListener('load', () => {
        if (!localStorage.getItem('userId')) {
            console.log("No user session found.");
        }
    });
</script>
</body>
</html>